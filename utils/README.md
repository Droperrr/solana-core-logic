# utils

Вспомогательные функции для работы с сигнатурами, токен-аккаунтами и фильтрацией данных в Solana Data Pipeline.

## Назначение
- Получение и фильтрация сигнатур для токенов и их ATA (Associated Token Accounts)
- Дедупликация, сортировка, лимитирование и фильтрация новых транзакций
- Интеграция с RPC и БД для эффективного сбора и отбора данных

## Архитектура и ключевые файлы
- `signature_handler.py` — Главный модуль:
  - `fetch_signatures_for_token` — сбор сигнатур для минта и всех его ATA, с дедупликацией, сортировкой и лимитированием
  - `filter_new_signatures` — фильтрация новых сигнатур по БД
  - Использует `rpc.helius_rpc` и `db.db_manager` для интеграции с инфраструктурой

## Пример использования
```python
from utils.signature_handler import fetch_signatures_for_token, filter_new_signatures

# Получить сигнатуры для минта (и всех ATA)
sigs = fetch_signatures_for_token(
    token_mint_address="So111...111",
    fetch_limit_per_call=1000,
    total_tx_limit=5000,
    direction='e' # 'e' — новые сначала, 'b' — старые сначала
)

# Оставить только новые сигнатуры (не встречавшиеся в БД)
new_sigs = filter_new_signatures(sigs)
```

## Best practices
- Используйте fetch_signatures_for_token для полного охвата всех адресов (минт + ATA)
- Всегда фильтруйте новые сигнатуры перед обработкой, чтобы избежать дубликатов
- Для больших токенов используйте лимиты и пагинацию для контроля объёма данных
- Логируйте все этапы сбора и фильтрации для аудита

## Ограничения
- Требует настроенных модулей `rpc` и `db` для работы
- Не реализует CLI, только Python API
- Для production рекомендуется добавить обработку edge-cases и расширить тесты 